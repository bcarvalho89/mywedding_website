/*!
 * mywedding_website
 * My Wedding Website
 * http://brukel.cf
 * @author Bruno Carvalho
 * @version 1.0.0
 * Copyright 2016. MIT licensed.
 */
!function(e,a,s,t){"use strict";e(function(){function t(e,a,s){var t=e.substring(6),n=e.substring(0,2),o=e.substring(3,5),i=new Date(t,o-1,n),l=new Date,r="",c=Date.dateDiff("d",i,l);0===c&&s.html("É hoje!"),c>0&&(r=c,s.html("Estamos casados há "+r+" dias")),1===c&&(r=c,s.html("Estamos casados há "+r+" dia")),0>c&&(r=Math.abs(c),s.html("Faltam "+r+" dias")),-1===c&&(r=Math.abs(c),s.html("É amanhã!"))}var n=e("#messages"),o="inc/guestbook/message.php",i=n.data("page"),l=e(a).height(),r=75,c=e(".menu"),d=e("header"),m=e(".countdown-text"),p=e("#load-more"),u=e(".to-top");Date.dateDiff=function(e,a,s){e=e.toLowerCase();var t=s-a,n={w:6048e5,d:864e5,h:36e5,n:6e4,s:1e3};return Math.floor(t/n[e])},e(s).ready(function(){t("28/08/2016","11:00h",m),e("#form_rsvp").on("change",".child",function(){var a=e(this);a.prop("checked")?a.after('<label>Idade</label><input class="age" type="text" />'):(a.next().remove(),a.next().remove())}),e("#more-people").click(function(a){a.preventDefault();var s=e("#form_rsvp .form-group"),t=s.last(),n=s.length,o='<div class="form-group"><label>Pessoa '+(n+1)+'</label><input class="name" type="text" placeholder="Digite o nome completo" /><label>É criança?</label><input class="child" type="checkbox" name="child" /><button class="btn remove"><i class="icon-user-remove"></i></button></div>';t.after(o)}),e("#form_rsvp").on("click",".remove",function(){e(this).parent().remove()}),e("#form_rsvp .confirmation").click(function(a){a.preventDefault();var s={},t=[],n=[],o=e("#form_rsvp .response"),i=e("#form_rsvp .form-group");i.each(function(a,i){var l=e.trim(e(i).find(".name").val()),r=!1,c=null,d=!1;if(l.length<10&&(n.push("Digite o nome completo"),d=!0),e(i).find(".child").prop("checked")&&(r=!0,c=e.trim(e(i).find(".age").val()),c=parseInt(c),(c>14||isNaN(c))&&(n.push("Digite a idade corretamente"),d=!0)),d){for(var m="",p=0;p<n.length;p++)m+="<span>"+n[p]+"</span>";o.html(m)}else o.html(""),s={name:l,child:r,age:c},t.push(s)}),console.log(t)}),u.click(function(a){a.preventDefault(),e("body,html").animate({scrollTop:0},400)}),c.on("click","a",function(a){a.preventDefault();var s=e("#"+e(this).data("section"));e("html, body").stop().animate({scrollTop:s.offset().top-r},500,"swing",function(){})}),e("#guestbook_form").submit(function(a){a.preventDefault();var t=e(this).find("#guestName").val(),i=e(this).find("#guestMessage").val(),l=this,r=e(l).find(".response");e.ajax({url:o,type:"POST",dataType:"json",data:{name:t,message:i,insert:!0}}).done(function(e){if(console.log(e),r.html(""),e.success){var a=e.data,t='<div class="message"><div class="message-wrap"><p>'+a.message+"</p></div><h2>"+a.name+"</h2><span>"+a.dateTime+"</span></div>",o=s.createElement("div"),i=s.querySelector("#messages");salvattore.append_elements(i,[o]),o.outerHTML=t,n.removeClass("no-messages").find(".no-message").remove(),p.fadeIn(),l.reset()}else{for(var c="",d=0;d<e.msg.length;d++)c+="<span>"+e.msg[d]+"</span>";r.html(c)}}).fail(function(e){console.log(e)}).always(function(){})}),e.getJSON(o,{select:!0,page:i},function(a){if(a.success){var t=a.data;e.each(t,function(e,a){var t='<div class="message"><div class="message-wrap"><p>'+a.message+"</p></div><h2>"+a.name+"</h2><span>"+a.dateTime+"</span></div>",n=s.createElement("div"),o=s.querySelector("#messages");salvattore.append_elements(o,[n]),n.outerHTML=t}),setTimeout(function(){},10)}else p.hide(),n.addClass("no-messages").append('<div class="no-message"><p>Não recebemos nenhuma mensagem. Que tal ser o primeiro?</p></div>')}),p.click(function(){var a=n.data("page"),t=e(this);t.find("i").toggleClass("icon-plus icon-spinner"),e.getJSON(o,{select:!0,page:a+1},function(o){if(o.success){var i=o.data;e.each(i,function(e,a){var t='<div class="message"><div class="message-wrap"><p>'+a.message+"</p></div><h2>"+a.name+"</h2><span>"+a.dateTime+"</span></div>",n=s.createElement("div"),o=s.querySelector("#messages");salvattore.append_elements(o,[n]),n.outerHTML=t}),n.data("page",a+1),t.find("i").toggleClass("icon-spinner icon-plus")}else setTimeout(function(){t.find("i").remove(),t.addClass("disabled"),t.attr("disabled","disabled")},200)})})}),e(a).resize(function(){}),e(a).load(function(){setTimeout(function(){e("body").addClass("loaded")},1e3)}),e(a).scroll(function(){var s=a.scrollY,t=e(this).scrollTop(),n=15*s/e(a).height();e("#intro .cover").css({"background-position-y":100-n+"%"}),t>l-6*r?(d.addClass("pinned"),u.addClass("show")):(d.removeClass("pinned"),u.removeClass("show")),e(".menu a").each(function(){var a=e(this),s=e("#"+a.data("section"));s.position().top-2*r<=t&&s.position().top+s.height()>t?(e(".menu a").removeClass("active"),a.addClass("active")):a.removeClass("active")})})})}(jQuery,window,document);